<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Tonerliste</title>
  <link href="../lib/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      padding-top: 5px;
    }
  </style>
  <link href="css/style.css" rel="stylesheet">
  <link href="../lib/css/bootstrap-responsive.min.css" rel="stylesheet">
</head>
<body>


  <div class="container"> 
    <h1>Tonerliste</h1>
     
    <div class="error"></div>
    <div class="page">
      <div class="toners"></div>
      <div class="drums"></div>
    </div>
    
  </div>


  <script src="../lib/js/jquery-1.8.3.min.js" type="text/javascript"></script>
  <script src="../lib/js/bootstrap.min.js" type="text/javascript"></script>  
  <script src="../lib/js/underscore-min.js" type="text/javascript"></script>
  <script src="../lib/js/backbone-min.js" type="text/javascript"></script>



  <script type="text/template" id="error-template">    
    <div class="alert alert-error">
    <button type="button" class="close" data-dismiss="alert">&times;</button>
    <strong>Fehler!</strong> <%- error %>
    </div>   
  </script>

  <script type="text/template" id="toners-template">     
    <p><% if(visibility==0){ %>
    <a href="#all" class="btn btn-info btn-mini"><i class="icon-eye-open icon-white"></i> Versteckte Einblenden</a></p>
    <% }else{ %>
    <a href="#" class="btn btn-info btn-mini"><i class="icon-eye-close icon-white"></i> Versteckte Ausblenden</a></p>
    <% } %>
    <span class="label label-inverse">Toner</span>
    <div class="well-box">
      <table class="table table-hover table-condensed">
        <thead>
          <tr>
            <th>Drucker</th>
            <th>Modell</th>
            <th>Farbe</th>
            <th>Anzahl</th>
            <th><a href="#new" class="btn btn-small btn-primary"><i class="icon-plus icon-white"></i> Neuen Toner</a></th>
          </tr>
        </thead>
        <tobdy>
          <% _.each(toners, function(toner){ %>
          <% if(toner.get('hidden')==0||visibility==1){ %>
            <tr class="<%- toner.get('stock')>0&&toner.get('stock')<3 ? 'warning' :'' %>
            <%- toner.get('stock')==0 ? 'error' : '' %>">
              <td><%- toner.get('printer') %></td>
              <td><%- toner.get('name') %></td>
              <td><%  var color = toner.get('color')%>
              <%- color==1 ? 'black' : '' %>
              <%- color==2 ? 'magenta' : '' %>
              <%- color==3 ? 'cyan' : '' %>
              <%- color==4 ? 'yellow' : '' %>
              <%- color==5 ? 'universal' : '' %></td>
              <td><%- toner.get('stock') %></td>
              <td>
                <div class="btn-group">
                  <a href="#" class="btn btn-small" id="popover<% -toner.id %>" rel="popover" data-placement="left" data-content="<form class='input-append'><input type='text' class='input-small' placeholder='Grund...' ></input><a class='btn btn-success' href='#/toner/<%- toner.id %>/transaction/1'>Speichern</a></form>" data-original-title="Tonerbestand um 1 erniedrigen"><i class="icon-minus icon"></i></a>
                  <a href="#/edit/<%- toner.id %>" class="btn btn-small btn-inverse"><i class="icon-edit icon-white"></i> Details</a>
                  <a href="#" class="btn btn-small" id="popover<% -toner.id %>" rel="popover" data-placement="left" data-content="<form class='input-append'><input id='<%- 'reasonplus' + toner.id %>' type='text' class='input-small' placeholder='Grund...' ></input><a class='btn btn-success' <% var elem = 'reasonplus' + toner.id %> href='#/toner/<%- toner.id %>/transaction/2/'>Speichern</a><% %></form>" data-original-title="Tonerbestand um 1 erhöhen"><i class="icon-plus"></i></a>
                </div>
              </td>
            </tr>
          <% }}); %>
        </tbody>
      <tables>
    </div>
  </script>

  <script type="text/template" id="drums-template">    
    <span class="label label-inverse">Trommeln</span>
    <div class="well-box">
      <table class="table table-hover table-condensed">
        <thead>
          <tr>
            <th>Drucker</th>
            <th>Modell</th>
            <th>Farbe</th>
            <th>Anzahl</th>
            <th><a href="#new" class="btn btn-small btn-primary"><i class="icon-plus icon-white"></i> Neue Trommel</a></th>
          </tr>
        </thead>
        <tobdy>
          <% _.each(drums, function(drum){ %>
          <% if(drum.get('hidden')==0||visibility==1){ %>
            <tr class="<%- drum.get('stock')>0&&drum.get('stock')<3 ? 'warning' :'' %>
            <%- drum.get('stock')==0 ? 'error' : '' %>">
              <td><%- drum.get('printer') %></td>
              <td><%- drum.get('name') %></td>
              <td><%  var color = drum.get('color')%>
              <%- color==1 ? 'black' : '' %>
              <%- color==2 ? 'magenta' : '' %>
              <%- color==3 ? 'cyan' : '' %>
              <%- color==4 ? 'yellow' : '' %>
              <%- color==5 ? 'universal' : '' %></td>
              <td><%- drum.get('stock') %></td>
              <td>
                <div class="btn-group">
                  <a href="#" class="btn btn-small" id="popover<% -drum.id %>" rel="popover" data-placement="left" data-content="<form class='input-append'><input type='text' class='input-small' placeholder='Grund...' ></input><a class='btn btn-success' href='#/drum/<%- drum.id %>/transaction/1'>Speichern</a></form>" data-original-title="Trommelbestand um 1 erniedrigen"><i class="icon-minus icon"></i></a>
                  <a href="#/edit/<%- drum.id %>" class="btn btn-small btn-inverse"><i class="icon-edit icon-white"></i> Details</a>
                  <a href="#" class="btn btn-small" id="popover<% -drum.id %>" rel="popover" data-placement="left" data-content="<form class='input-append'><input type='text' class='input-small' placeholder='Grund...' ></input><a class='btn btn-success' href='#/drum/<%- drum.id %>/transaction/2'>Speichern</a></form>" data-original-title="Trommelbestand um 1 erhöhen"><i class="icon-plus"></i></a>
                </div>
              </td>
            </tr>
          <% }}); %>
        </tbody>
      <tables>
    </div>
  </script>

  <script type="text/javascript">

    var Toners = Backbone.Collection.extend({
      url: '/api/tonerliste/toners'
    });

    var Drums = Backbone.Collection.extend({
      url: '/api/tonerliste/drums'
    });

    var TonerList = Backbone.View.extend({
      el: '.toners',
      render : function(visibility) {
        var that = this;
        var toners = new Toners();
        toners.fetch({
          success: function(toners){ 
            var template = _.template($('#toners-template').html(), {toners: toners.models, visibility: visibility});
            that.$el.html(template);
            $('[id^=popover]').popover({ html : true });
          },
          error: function(){
            var template = _.template($('#error-template').html(), {error: 'Request GET error in /api/tonerliste/toners'});
            that.$el.html(template);
          }
        });
      }
    });

    var DrumList = Backbone.View.extend({
      el: '.drums',
      render : function(visibility) {
        var that = this;
        var drums = new Drums();
        drums.fetch({
          success: function(drums){ 
            var template = _.template($('#drums-template').html(), {drums: drums.models, visibility: visibility});
            that.$el.html(template);
            $('[id^=popover]').popover({ html : true });
          },
          error: function(){
            var template = _.template($('#error-template').html(), {error: 'Request GET error in /api/tonerliste/drums'});
            that.$el.html(template);
          }
        });
      }
    });




    var Router = Backbone.Router.extend({
      routes: {
        '': 'home-hidden',
        'all': 'home-visible',
        ':type/:id/transaction/:action': 'stock',
      }
    });

    var tonerList = new TonerList();
    var drumList = new DrumList();

    var router = new Router;

    router.on('route:home-hidden', function(){
      tonerList.render(0);
      drumList.render(0);
    });

    router.on('route:home-visible', function(){
      tonerList.render(1);
      drumList.render(1);
    });

    router.on('route:stock', function(){
      //console.log('hallo');
    });

    Backbone.history.start();
  </script>


</body>
</html> 



